## 🤖 Assistant

# “英语课程营销文案工坊”完整开发与部署指南

交付对象：给 Trae 直接照着实施
产出形式：一个可公开访问的 Web 应用（推荐 Streamlit + OpenRouter），支持生成多渠道招生文案，并提供下载与复制。

---

## 1. 项目概述

- 应用名：英语课程营销文案工坊
- 目标用户：英语学科运营/课程顾问/老师
- 核心价值：一键生成多渠道一致风格的招生文案，减少重复写作时间，确保表述合规
- MVP 输出渠道：
 - 朋友圈图文
 - 海报 Slogan
 - 短视频 30 秒口播脚本
 - 可选：小红书标题/正文/话题
- 关键约束：避免夸大承诺和敏感词，输出必须含明确 CTA

---

## 2. 技术栈与账户

- 前端/后端：Streamlit
- LLM 网关：OpenRouter（推荐模型：anthropic/claude-3.5-sonnet 或 openai/gpt-4o-mini）
- Python：3.10+
- 依赖：openai>=1.40.0、streamlit
- 部署：Hugging Face Spaces 或 Streamlit Community Cloud（均可公开链接）

准备事项：
- 准备 OpenRouter API Key，并开通计费或余额。
- Git 仓库权限（用于自动部署）。

---

## 3. 目录结构

```text
marketing-copy-studio/
├─ app.py
├─ requirements.txt
├─ runtime.txt                 # 可选：为部署指定 Python 版本（例如 3.10）
├─ prompts/
│  └─ system_prompt.txt
├─ assets/
│  └─ example_inputs.md
├─ README.md
```

---

## 4. 需求与功能清单（MVP）

- 表单字段
 - 课程名、年龄/级别、班型与课时、时间与地点、核心卖点（多行）、家长痛点（多行）
 - 师资人设（亲和/专业/学术/幽默）
 - 品牌风格（热烈/理性/温情/权威）、语气强度（稳健/适中/强势）
 - 是否加入 Emoji（是/否）
 - 禁用词（默认：保分, 速成, 100%, 包通过）
 - 渠道多选（朋友圈/海报/短视频/小红书），每类生成条数（1-5）
- 生成结果
 - 分渠道结构化输出
 - 统一 CTA 模板与合规提示
- 交互
 - 一键填充示例
 - 生成状态 Loading
 - 导出 TXT 下载按钮
- 合规
 - 结果内敏感词检测并提示
 - 输出自动附加“效果因人而异”等风控语句

---

## 5. Prompt 设计

prompts/system_prompt.txt

```text
你是教育培训行业的资深市场文案。任务：根据输入生成不同渠道的中文招生文案。

硬性要求：
- 遵循输入的“品牌风格、语气、人设、是否使用Emoji”。
- 严禁夸大与绝对化承诺（如100%、保分、速成、包通过、立刻逆袭等）。
- 如出现敏感词，自动换成“尽可能/有望/更有可能/倾向于”等表述。
- 每条文案必须包含明确的行动号召 CTA（如“私信‘{课程名}’领取试学/预约测评”）。
- 海报 Slogan 8~12字；短视频口播约30秒，包含：开场吸引 -> 痛点 -> 卖点 -> 社会证明 -> CTA。
- 若有优惠/时间地点/联系方式，需自然融入文案。

输出规范：
- 请按选择的渠道分别输出。
- 每个渠道下用清晰小标题与编号列表。
- 朋友圈文案每条附3~5个话题标签。
- 最后附“统一CTA模板”和“合规提醒”两段固定文本。
```

用户提示（由代码拼接）包含字段：
- 课程名、年龄/级别、班型与课时、时间与地点、核心卖点、家长痛点
- 师资人设、品牌风格、语气强度、是否加入Emoji
- 禁用词、渠道、多条数

---

## 6. 代码

app.py

```python
import os
import re
from pathlib import Path
import streamlit as st
from openai import OpenAI

# ------------------------
# 配置
# ------------------------
BASE_URL = "https://openrouter.ai/api/v1"
# 可选模型："anthropic/claude-3.5-sonnet" / "openai/gpt-4o-mini" / "google/gemini-1.5-pro-latest"
MODEL = "anthropic/claude-3.5-sonnet"

APP_TITLE = "英语课程营销文案工坊"
APP_DESC = "一键生成朋友圈/海报/短视频等多渠道招生文案，附CTA与合规提示。"

# OpenRouter 建议增加的头信息（统计与合规）
DEFAULT_HEADERS = {
    "HTTP-Referer": "https://example.com",  # 换成你的部署域名
    "X-Title": APP_TITLE
}

# ------------------------
# 工具函数
# ------------------------
@st.cache_data(show_spinner=False)
def load_system_prompt() -> str:
    p = Path("prompts/system_prompt.txt")
    if p.exists():
        return p.read_text(encoding="utf-8")
    # 兜底简版
    return """你是教育行业资深市场文案...（建议创建 prompts/system_prompt.txt 覆盖此处）"""

def get_client() -> OpenAI:
    api_key = os.environ.get("OPENROUTER_API_KEY")
    if not api_key:
        st.sidebar.error("未检测到 OPENROUTER_API_KEY 环境变量。部署时请在Secrets中设置。")
    return OpenAI(base_url=BASE_URL, api_key=api_key, default_headers=DEFAULT_HEADERS)

def build_user_prompt(data: dict) -> str:
    return f"""
课程名：{data['course_name']}
年龄/级别：{data['age_level']}
班型与课时：{data['format_hours']}
时间与地点：{data['time_place']}
核心卖点（分条）：{data['selling_points']}
家长痛点（分条）：{data['parent_pains']}
师资人设：{data['teacher_persona']}
品牌风格：{data['brand_style']}
语气强度：{data['tone_strength']}
是否加入Emoji：{data['use_emoji']}
禁用词：{data['banned_words']}
渠道：{", ".join(data['channels'])}
每类生成条数：{data['n_per_channel']}
请严格按渠道分别输出内容，并在最后附统一CTA模板与合规提醒。
"""

def detect_banned_words(text: str, banned_words: list[str]) -> list[str]:
    hit = []
    for w in banned_words:
        w = w.strip()
        if not w:
            continue
        if re.search(re.escape(w), text, flags=re.IGNORECASE):
            hit.append(w)
    return hit

def sanitize_banned_words(text: str, banned_words: list[str]) -> str:
    # 轻度净化：高亮提示但不硬替换，避免误伤语义
    for w in banned_words:
        if not w.strip():
            continue
        text = re.sub(re.escape(w), f"【合规敏感词：{w}】", text, flags=re.IGNORECASE)
    return text

# ------------------------
# UI
# ------------------------
st.set_page_config(page_title=APP_TITLE, layout="wide")
st.title(APP_TITLE)
st.caption(APP_DESC)

with st.sidebar:
    st.subheader("课程信息")
    course_name   = st.text_input("课程名", "S2自然拼读进阶班")
    age_level     = st.text_input("年龄/级别", "7-9岁 / S2")
    format_hours  = st.text_input("班型与课时", "小班 12次×90min")
    time_place    = st.text_input("时间与地点", "每周六 10:00-11:30 / XX校区")
    selling_points= st.text_area("核心卖点（换行分条）", "系统Phonics\n大量跟读纠音\n分层作业\n家校共育")
    parent_pains  = st.text_area("家长痛点（换行分条）", "发音不准\n读词靠猜\n记词低效")

    st.subheader("风格与合规")
    teacher_persona = st.selectbox("师资人设", ["亲和", "专业", "学术", "幽默"])
    brand_style     = st.selectbox("品牌风格", ["热烈", "理性", "温情", "权威"])
    tone_strength   = st.selectbox("语气强度", ["稳健", "适中", "强势"])
    use_emoji       = st.selectbox("是否加入Emoji", ["是", "否"])
    banned_words    = st.text_input("禁用词（逗号分隔）", "保分, 速成, 100%, 包通过")

    st.subheader("生成设置")
    channels = st.multiselect(
        "选择渠道", ["朋友圈", "海报", "短视频", "小红书"],
        default=["朋友圈", "海报", "短视频"]
    )
    n_per_channel = st.slider("每类生成条数", 1, 5, 3)

    col_a, col_b = st.columns(2)
    with col_a:
        gen = st.button("生成文案", type="primary")
    with col_b:
        if st.button("填充示例"):
            st.session_state.update({
                "course_name": "S1自然拼读启蒙班",
                "age_level": "6-8岁 / S1",
                "format_hours": "走读 10次×90min",
                "time_place": "周日 10:00-11:30 / XX校区",
            })

# 将sidebar变量打包
data = dict(
    course_name=course_name,
    age_level=age_level,
    format_hours=format_hours,
    time_place=time_place,
    selling_points=selling_points,
    parent_pains=parent_pains,
    teacher_persona=teacher_persona,
    brand_style=brand_style,
    tone_strength=tone_strength,
    use_emoji=use_emoji,
    banned_words=banned_words,
    channels=channels,
    n_per_channel=n_per_channel
)

# ------------------------
# 主逻辑
# ------------------------
if gen:
    if not channels:
        st.warning("请至少选择一个渠道。")
        st.stop()

    sys_prompt = load_system_prompt()
    user_prompt = build_user_prompt(data)
    client = get_client()

    with st.spinner("正在生成文案..."):
        try:
            resp = client.chat.completions.create(
                model=MODEL,
                messages=[
                    {"role": "system", "content": sys_prompt},
                    {"role": "user", "content": user_prompt}
                ],
                temperature=0.7,
                top_p=0.95
            )
            out = resp.choices[0].message.content
        except Exception as e:
            st.error(f"生成失败：{e}")
            st.stop()

    # 合规提示（检测禁用词）
    banned_list = [w.strip() for w in banned_words.split(",")]
    hits = detect_banned_words(out, banned_list)
    if hits:
        st.warning("检测到潜在敏感词（已在文案中标注）： " + "、".join(hits))
        out = sanitize_banned_words(out, banned_list)

    st.subheader("生成结果")
    st.markdown(out)

    st.download_button(
        "下载为TXT",
        data=out,
        file_name="marketing_copy.txt",
        mime="text/plain"
    )

st.markdown("---")
st.caption("合规提醒：学习效果因人而异，需持续投入；本工具输出仅作参考文案，最终发布前请再次人工审核。")
```

requirements.txt

```text
streamlit
openai>=1.40.0
```

runtime.txt（可选，用于 Spaces/某些平台指定 Python 版本）

```
3.10
```

prompts/system_prompt.txt（见“Prompt 设计”章节内容，完整保存为文件并可按需修改）

assets/example_inputs.md（开发调试可用）

```markdown
课程名：S1自然拼读启蒙班
年龄/级别：6-8岁 / S1
班型与课时：走读 10次×90min
时间与地点：周日 10:00-11:30 / XX校区
核心卖点：27个核心音素；课堂纠音；家庭练习卡；阶段测评
家长痛点：读词靠猜；发音不准；记词低效
风格：温情；人设：亲和；语气：稳健；Emoji：是
渠道：朋友圈、海报、短视频；每类3条
```

README.md（精简示例）

```markdown
# 英语课程营销文案工坊

一键生成朋友圈/海报/短视频招生文案。基于 Streamlit + OpenRouter。

## 本地运行
1. Python 3.10+
2. 配置环境变量：
   - macOS/Linux: `export OPENROUTER_API_KEY=sk-xxxx`
   - Windows PowerShell: `$env:OPENROUTER_API_KEY="sk-xxxx"`
3. 安装依赖并运行：
   ```bash
   pip install -r requirements.txt
   streamlit run app.py
   ```

## 模型与费用
默认 `anthropic/claude-3.5-sonnet`。可在 app.py 中更换模型。费用按 OpenRouter 实际计费。

## 合规
输出严禁绝对化承诺；请在发布前人工审核。
```

---

## 7. 开发步骤（Trae 执行清单）

1) 初始化仓库与代码
- 创建目录结构与文件，写入上述代码与 prompts。
- 在本地配置 OPENROUTER_API_KEY，调通一次生成。

2) 基本功能联调
- 确保表单字段能正常传参，生成不同渠道的多条文案。
- 增加 Loading、下载按钮；验证合规敏感词提示。

3) 视觉与细节
- 调整 Streamlit theme 或页面宽度；加入页面标题与简要说明。
- 增加“示例一键填充”按钮，便于演示。

4) 测试用例
- 用 “assets/example_inputs.md” 的示例跑通。
- 再试 2-3 套不同“风格/人设/语气/Emoji”的组合。
- 验证禁用词检测（在卖点或痛点中临时加入“100%”测试）。

5) 部署
- 选一种方式部署（建议 Hugging Face Spaces 或 Streamlit Community Cloud）。
- 配置 Secrets：OPENROUTER_API_KEY。
- 获取公开链接，并进行在线验证。

6) 交付与截图
- 截图：主页、一次完整生成结果、下载按钮弹出。
- 返回链接与截图给学员提交。

---

## 8. 部署指南

### 方案A：Hugging Face Spaces（推荐，简单稳定）
1) 新建 Space
 - Space SDK 选择 “Streamlit”
 - Python 版本与硬件选择默认即可
2) 推送代码
 - 连接 GitHub 仓库或直接在 Web 编辑器上传所有文件
3) 设置 Secrets
 - 在 Space Settings -> Repository secrets 添加：
 - `OPENROUTER_API_KEY=sk-xxxx`
4) 自动构建与上线
 - 等待 Build 完成，访问公开链接
5) 首次验证
 - 运行示例输入，确认输出正常

### 方案B：Streamlit Community Cloud
1) 连接 GitHub 仓库，创建新应用
2) Advanced settings -> Secrets：
```
OPENROUTER_API_KEY = "sk-xxxx"
```
3) 部署完成后访问公开链接

---

## 9. 提交作业清单（直接复制）

- 应用主题：英语课程营销文案工坊
- 应用链接：https://你的公开地址
- 截图：
 - 主页与输入表单
 - 一次生成后的完整结果页
 - 下载按钮或文件保存界面

---

## 10. 测试要点

- 不同渠道勾选组合是否都能输出
- 海报 Slogan 是否控制在 8~12 字
- 短视频口播是否包含“开场吸引-痛点-卖点-社会证明-CTA”
- 敏感词检测是否生效
- 导出 TXT 内容是否完整换行无乱码

---

## 11. 扩展建议（加分项）

- 增加“复制到剪贴板”按钮（可用 st.code + 前端组件）
- 导出 Markdown/Word（python-docx）或一键生成海报图片（Pillow/WeasyPrint）
- 预设三种文案风格模板（热推款/理性解读/家长故事体）一键切换
- 增加“机构品牌与课程库”下拉预填表单
- 引入响应缓存（根据输入哈希）以节省费用
- 增加调用统计与大致 token 费用估算

---

## 12. 合规与隐私

- 禁止使用绝对化承诺与效果保证词汇；提供“效果因人而异”提示
- 输出仅作参考，需人工审核后发布
- 不收集用户个人隐私数据；若部署在公网上，请在 README 与页面底部附隐私声明

---

## 13. 常见问题

- 看不到“生成”：检查 OPENROUTER_API_KEY 是否在部署平台的 Secrets 中配置
- 生成失败：切换模型或降低温度；稍后重试
- 中文输出不稳定：优先选择 `anthropic/claude-3.5-sonnet` 或 `openai/gpt-4o-mini`
- 成本控制：减少条数/选择 mini 模型/启用缓存

---

完成以上步骤后，即可得到一个可公开访问的“英语课程营销文案工坊”应用。若需要，我可以再提供一版 Gradio 实现或帮你把仓库与部署流水线（CI）配置好。祝顺利提交作业！
